<article ng-controller="EvaluationApplyController" class="container-fluid">
    <!-- 上部分 -->
    <section class="row">
        <div class="form-group col-lg-2">
            <label class="col-md-4 control-label">姓名</label>
            <div class="col-md-8">
                <input type="text" class="form-control" ng-model="data.real_name">
            </div>
        </div>
        <div class="form-group col-lg-2">
            <label class="col-md-4 control-label">身份证号</label>
            <div class="col-md-8">
                <input type="text" class="form-control" ng-model="data.id_card">
            </div>
        </div>
        <div class="form-group col-lg-2">
            <label class="col-md-4 control-label">手机号</label>
            <div class="col-md-8">
                <input type="text" class="form-control" ng-model="data.telephone">
            </div>
        </div>
        <div class="form-group col-md-2">
            <label class="col-md-4 control-label">省份</label>
            <div class="col-md-8">
                <ui-select ng-model="data.province_code" theme="bootstrap" on-select="initCity($item)">
                    <ui-select-match allow-clear="true" placeholder="全部">{{$select.selected.city_name}}</ui-select-match>
                    <ui-select-choices repeat="item.city_code as item in provinces | orderBy:'city_code' | filter: $select.search">
                        <span ng-bind-html="item.city_name | highlight: $select.search"></span>
                    </ui-select-choices>
                </ui-select>
            </div>
        </div>
        <div class="form-group col-md-2">
            <label class="col-md-4 control-label">城市</label>
            <div class="col-md-8">
                <ui-select ng-model="data.city_code" theme="bootstrap">
                    <ui-select-match allow-clear="true" placeholder="全部">{{$select.selected.city_name}}</ui-select-match>
                    <ui-select-choices repeat="item.city_code as item in cities | orderBy:'city_code' | filter: $select.search">
                        <span ng-bind-html="item.city_name | highlight: $select.search"></span>
                    </ui-select-choices>
                </ui-select>
            </div>
        </div>
        <div class="form-group col-lg-2">
            <label class="col-md-4 control-label">院校</label>
            <div class="col-md-8">
                <input type="text" class="form-control" ng-model="data.school_name">
            </div>
        </div>
        <div class="form-group col-md-2">
            <label class="col-md-4 control-label">项目</label>
            <div class="col-md-8">
                <ui-select ng-model="data.item_id" theme="bootstrap" name="ex_primaryitem">
                    <ui-select-match allow-clear="true" placeholder="全部">{{$select.selected.dw_itemname}}</ui-select-match>
                    <ui-select-choices repeat="item.dw_itemid as item in projects | filter: $select.search">
                        <span ng-bind-html="item.dw_itemname | highlight: $select.search"></span>
                    </ui-select-choices>
                </ui-select>
            </div>
        </div>
        <div class="form-group col-lg-2">
            <label class="col-md-4 control-label">段位</label>
            <div class="col-md-8">
                <ui-select ng-model="data.level_id" theme="bootstrap" name="ex_level">
                    <ui-select-match allow-clear="true" placeholder="全部">{{$select.selected.es_leveldesc}}</ui-select-match>
                    <ui-select-choices repeat="item.es_level as item in levels | filter: $select.search">
                        <span ng-bind-html="item.es_leveldesc | highlight: $select.search"></span>
                    </ui-select-choices>
                </ui-select>
            </div>
        </div>
        <div class="form-group col-lg-2">
            <label class="col-md-4 control-label">申请状态</label>
            <div class="col-md-8">
                <ui-select ng-model="data.apply_status" theme="bootstrap" name="applyType">
                    <ui-select-match allow-clear="true" placeholder="全部">{{$select.selected.applytype_name}}</ui-select-match>
                    <ui-select-choices repeat="item.applytype_id as item in applyType | filter: $select.search">
                        <span ng-bind-html="item.applytype_name | highlight: $select.search"></span>
                    </ui-select-choices>
                </ui-select>
            </div>
        </div>
        <div class="form-group col-lg-2">
            <label class="col-md-4 control-label">是否考评点</label>
            <div class="col-md-8">
                <ui-select ng-model="data.had_examroom" theme="bootstrap" name="examroom">
                    <ui-select-match allow-clear="true" placeholder="全部">{{$select.selected.examroomtype_name}}</ui-select-match>
                    <ui-select-choices repeat="item.examroomtype_id as item in examroomType | filter: $select.search">
                        <span ng-bind-html="item.examroomtype_name | highlight: $select.search"></span>
                    </ui-select-choices>
                </ui-select>
            </div>
        </div>
        <div class="form-group col-md-2">
            <label class="col-md-4 control-label">订单时间</label>
            <div class="col-md-8">
                <input type="text" name="orderBegintime" class="form-control" uib-datepicker-popup="yyyy-MM-dd" name="Begintime" ng-model="data.applyBegintime" is-open="BegintimeOpened.opened" datepicker-options="beginDatepickerOptions" show-button-bar="false" date-to-timestamp ng-change="updateEndDate()">
                <i class="glyphicon glyphicon-calendar rili-icon" ng-click="openBegintime()"></i>
            </div>
        </div>
        <div class="form-group col-md-2">
            <label class="col-md-4 control-label text-center">至</label>
            <div class="col-md-8">
                <input type="text" name="orderEndtime" class="form-control" uib-datepicker-popup="yyyy-MM-dd" name="Endtime" ng-model="data.applyEndtime" is-open="EndtimeOpened.opened" datepicker-options="endDatepickerOptions" show-button-bar="false" date-to-timestamp-plus ng-change="updateBeginDate()">
                <i class="glyphicon glyphicon-calendar rili-icon" ng-click="openEndtime()"></i>
            </div>
        </div>
    </section>
    <div class="button-first">
        <button type="button" class="btn btn-raised btn-primary" ng-click="query()">查询</button>
        <button type="button" class="btn btn-raised btn-default" ng-click="reset()">重置</button>
    </div>
    <!-- 下部分 -->
    <section>
        <div class="table-responsive">
            <table class="table table-hover">
                <thead class="table-head">
                    <tr class="active">
                        <th>序号</th>
                        <th>姓名</th>
                        <th>性别</th>
                        <th>身份证号</th>
                        <th>手机号</th>
                        <th>所在省份</th>
                        <th>所在城市</th>
                        <th>学校类型</th>
                        <th>所在院校</th>
                        <th>项目</th>
                        <th>最高段位</th>
                        <th>申请状态</th>
                        <th>申请时间</th>
                        <th>拒绝理由</th>
                        <th>操作</th>
                    </tr>
                </thead>
                <tbody>
                    <tr ng-repeat="EvaluationApply in EvaluationApplys">
                        <td>{{($index+1)+(((PageIndex||1)-1)*PageSize)}}</td>
                        <td>{{EvaluationApply.real_name}}</td>
                        <td>{{EvaluationApply.sex==1?"男":"女"}}</td>
                        <td>{{EvaluationApply.id_card}}</td>
                        <td>{{EvaluationApply.telephone}}</td>
                        <td>{{EvaluationApply.provinceName}}</td>
                        <td>{{EvaluationApply.cityName}}</td>
                        <td>{{EvaluationApply.schooltype.schooltype_name}}</td>
                        <td>{{EvaluationApply.school_name}}</td>
                        <td>{{EvaluationApply.item.dw_itemname}}</td>
                        <td>{{EvaluationApply.level_id==4?"四段":(EvaluationApply.level_id==5?"五段":(EvaluationApply.level_id==6?"六段":(EvaluationApply.level_id==7?"七段":(EvaluationApply.level_id==8?"八段":"九段"))))}}</td>
                        <td>{{EvaluationApply.apply_status==0?"未审核":(EvaluationApply.apply_status==2?"已通过":"未通过")}}</td>
                        <td>{{timeStampToDate(EvaluationApply.apply_time)}}</td>
                        <td><a ng-click="reject(EvaluationApply)" class="pointer" ng-if="EvaluationApply.apply_status==3">查看</a></td>
                        <td>
                            <a ng-click="check(EvaluationApply)" class="pointer" ng-if="EvaluationApply.apply_status==0">审核</a>
                            <div ng-if="!EvaluationApply.apply_status==0">审核</div>
                        </td>
                    </tr>
                </tbody>
            </table>
        </div>
        <div cg-busy="EvaluationApplyPromise"></div>
        <div class="row">
            <div class="col-md-9">
                <select class="page-size" ng-model="PageSize" ng-change="pageChanged()">
                    <option value="20" ng-selected="true">每页显示20条</option>
                    <option value="40">每页显示40条</option>
                    <option value="60">每页显示60条</option>
                    <option value="80">每页显示80条</option>
                    <option value="100">每页显示100条</option>
                </select>
                <uib-pagination ng-model="PageIndex" ng-change="pageChanged()" total-items="EvaluationApplyCount" max-size="maxSize" items-per-page="PageSize" class="pagination-sm" boundary-link-numbers="true" rotate="false" previous-text="上一页" next-text="下一页"></uib-pagination>
            </div>
            <div class="col-md-3 text-right">
                <span>跳转到</span>
                <input type="text" ng-model="toPageNum" class="variant-form-control">
                <button ng-click="setPage()" class="to-page-num">确定</button>
            </div>
        </div>
    </section>
</article>
<!--审核-->
<script type="text/ng-template" id="CheckEvaluationApply.html">
    <form name="EvaluationApplyUpdateForm">
        <div class="panel-body">
            <h4>考评员申请</h4>
            <section>
                <div class="row">
                    <div class="col-md-6">
                        <div class="form-group">
                            <div class="col-md-4 text-right">姓名</div>
                            <div class="col-md-8">
                                {{data.real_name}}
                            </div>
                        </div>
                    </div>
                    <div class="col-md-6">
                        <div class="form-group">
                            <div class="col-md-4 text-right">性别</div>
                            <div class="col-md-8">
                                {{data.sex==1?"男":"女"}}
                            </div>
                        </div>
                    </div>
                </div>
                <div class="row">
                    <div class="col-md-6">
                        <div class="form-group">
                            <div class="col-md-4 text-right">身份证号</div>
                            <div class="col-md-8">
                                {{data.id_card}}
                            </div>
                        </div>
                    </div>
                    <div class="col-md-6">
                        <div class="form-group">
                            <div class="col-md-4 text-right">手机号</div>
                            <div class="col-md-8">
                                {{data.telephone}}
                            </div>
                        </div>
                    </div>
                </div>
                <div class="row">
                    <div class="col-md-6">
                        <div class="form-group">
                            <div class="col-md-4 text-right">电子邮箱</div>
                            <div class="col-md-8">
                                {{data.email}}
                            </div>
                        </div>
                    </div>
                    <div class="col-md-6">
                        <div class="form-group">
                            <div class="col-md-4 text-right">所在省市</div>
                            <div class="col-md-8">
                                {{data.provinceName}}
                            </div>
                        </div>
                    </div>
                </div>
                <div class="row">
                    <div class="col-md-6">
                        <div class="form-group">
                            <div class="col-md-4 text-right">项目</div>
                            <div class="col-md-8">
                                {{data.item.dw_itemname}}
                            </div>
                        </div>
                    </div>
                    <div class="col-md-6">
                        <div class="form-group">
                            <div class="col-md-4 text-right">段位</div>
                            <div class="col-md-8">
                                {{data.level_id==4?"四段":(data.level_id==5?"五段":(data.level_id==6?"六段":(data.level_id==7?"七段":(data.level_id==8?"八段":"九段"))))}}
                            </div>
                        </div>
                    </div>
                </div>
                <div class="row">
                    <div class="col-md-6">
                        <div class="form-group">
                            <div class="col-md-4 text-right">是否考评点</div>
                            <div class="col-md-8">
                                {{data.had_examroom?"是":"否"}}
                            </div>
                        </div>
                    </div>
                    <div class="col-md-6">
                        <div class="form-group">
                            <div class="col-md-4 text-right">申请状态</div>
                            <div class="col-md-8">
                                {{data.apply_status==0?"未审核":(EvaluationApply.apply_status==2?"已通过":"未通过")}}
                            </div>
                        </div>
                    </div>
                </div>
                <div class="row">
                    <div class="col-md-6">
                        <div class="form-group">
                            <div class="col-md-4 text-right">申请时间</div>
                            <div class="col-md-8">
                                {{timeStampToDate(data.apply_time)}}
                            </div>
                        </div>
                    </div>
                </div>
            </section>
        </div>
        <div class="modal-footer">
            <span class="text-danger pull-left" ng-bind="error"></span>
            <button class="btn withripple btn-raised btn-warning" type="button" ng-click="audit(data.apply_id,data.real_name,3)" style="float:left;left: 40%">拒绝</button>
            <button class="btn withripple btn-raised btn-primary" type="button" ng-click="audit(data.apply_id,data.real_name,2)" style="float:left;left: 50%">通过</button>
        </div>
    </form>
</script>
<!--审核-->
<script type="text/ng-template" id="passOrReject.html">
    <div class="modal-header">
        <h4 class="text-center">通过申请</h4>
    </div>
    <div class="modal-body" style="border-bottom: 1px solid #e5e5e5" ng-if="data.status==2">
        <h5 class="text-center">是否通过<span class="text-primary">【{{data.real_name}}】</span>老师的考评员申请？</h5>
    </div>
    <div class="modal-body col-md-12" style="border-bottom: 1px solid #e5e5e5;" ng-if="data.status==3">
        <h5 class="text-center">是否拒绝<span class="text-danger">【{{data.real_name}}】</span>老师的考评员申请？</h5>
        <textarea rows="3" placeholder="请输入拒绝理由(70字)" ng-model="data.apply_comment" class="col-md-offset-1 col-md-10">
        </textarea>
    </div>
    <div class="modal-footer" style="overflow: hidden;">
        <section class="row" style="margin: 12px 0;">
            <button class="btn withripple btn-raised btn-warning" type="button" ng-click="close()" style="float:left;left: 30%">取消</button>
            <button class="btn withripple btn-raised btn-primary" type="button" ng-click="pass()" style="float:left;left: 50%"><span ng-if="data.status==2">通过</span><span ng-if="data.status==3">确定</span></button>
        </section>
    </div>
</script>
<!--审核-->
<script type="text/ng-template" id="reject.html">
    <div class="modal-header">
        <h4 class="text-center">拒绝理由</h4>
    </div>
    <div class="modal-body">
        <span class="text-primary">【{{EvaluationApply.real_name}}】</span>考评员申请不通过理由：<b class="text-danger">{{EvaluationApply.apply_comment}}!</b>
    </div>
    <div class="modal-footer">
        <button class="btn withripple btn-raised btn-warning" type="button" ng-click="close()">关闭</button>
    </div>
</script>
